# some-midi-tools

Random python scripts I use for playing around with MIDI stuff

## Setup

1. **Create a virtual environment** (recommended):

   ```bash
   python3 -m venv .venv
   source .venv/bin/activate  # macOS/Linux
   # or `.venv\Scripts\activate` on Windows
   ```
2. **Install dependencies**:

   ```bash
   pip install mido python-rtmidi
   ```
3. **(Optional)** Pin exact versions for reproducibility:

   ```bash
   pip freeze > requirements.txt
   ```

## Overview

This repository provides four scripts to generate and play MIDI data from JSON specifications, plus an interactive configuration builder.

This repository provides four scripts to generate and play MIDI data from JSON specifications, plus an interactive configuration builder.

## 1. `buildconfig.py`

Interactive tool to create a unified `config.json`:

```bash
python buildconfig.py
```

**Resulting `config.json` structure**:

```json
{
  "port": "<MIDI port name>",
  "channel": <MIDI channel 1-16>,
  "files": ["file1.json", "file2.json", ...],
  "output": "output.mid"
}
```

## 2. `json2midi.py`

Convert one or more JSON song files into a single `.mid` file:

```bash
python json2midi.py config.json
```

* Reads `files` and `output` from the same `config.json`.
* Concatenates all `SONG` events into `output`.
* Tempo set from first file’s `BPM` (default 120).

## 3. `sendmidi.py`

Play an existing MIDI file through the specified port:

```bash
python sendmidi.py config.json
```

* Uses `port`, `channel`, and `output` from `config.json`.
* Streams `output.mid` via Mido’s `MidiFile.play()`.

## 4. `sendjson.py`

Stream JSON song files directly to a MIDI port, without intermediate file:

```bash
python sendjson.py config.json
```

* Reads `files`, `port`, and `channel` from `config.json`.
* For each song file, parses `SONG` events and sends them in real time.

---

# JSON Song Specification

Each JSON song file must be an object with:

* **`BPM`** (optional, default 120)
* **`ticks_per_beat`** (optional, default 480)
* **`SONG`**: array of **note-event** objects

### Note-Event Properties

| Property    | Type                          | Default      | Description                                                                                                               |
| ----------- | ----------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------- |
| `play`      | `string` \| `array` \| `null` | **required** | Note name (e.g. `"C4"`), array of names/`null` for rests, or `null` for rest. Prefix `-` for explicit `note_off`.         |
| `time`      | integer                       | `1`          | Denominator of whole note (4=quarter, 8=eighth, etc.)                                                                     |
| `velocity`  | integer 0–127                 | `100`        | MIDI velocity                                                                                                             |
| `stop`      | boolean                       | `true`       | If `false`, suppresses the automatic `note_off`                                                                           |
| `repeat`    | integer                       | `0`          | Repeat this event N additional times                                                                                      |
| `range`     | `[length, offset]`            | *none*       | When `play` is a single note, expands to a sequence of `length` notes stepping by `offset` semitones (supports negative). |
| `transpose` | integer                       | `0`          | Shift all notes in this event by N semitones (supports negative).                                                         |
| `reverse`   | boolean \| string             | `false`      | If true, reverses the order of notes generated by `play` or `range`.                                                      |

**Example**

```json
{
  "BPM": 120,
  "SONG": [
    { "play": "C4",                 "time": 4 },               // quarter-note C
    { "play": ["E4","G4"],         "time": 8, "stop":false },// overlapping eighth-note dyad
    { "play": null,                   "time": 4 },               // quarter rest
    { "play": "C3",                 "time": 16, "range":[4,3] },// arpeggio: C3,E3,G3,B3 (sixteenth)
    { "play": ["C4","D4","E4"],   "time": 8,  "reverse":true },// reversed sequence
    { "play": "C4",                 "time": 4,  "transpose":12 } // one octave up
  ]
}
```

### Full Disclosure

This was also a test to just have ChatGPT wrtie code with little of my input, and it seems to work. So I guess this is my first "vibe code" project. Neat...